from opentrons import protocol_api,types
import serial
import time
import sys


metadata = {'apiLevel': '2.3'}

def run(protocol: protocol_api.ProtocolContext):

    if protocol.is_simulating() == False:
        sys.path.insert(0, "/data")
        import DispenseUnit_1161
        import pyTMCL
        serial_port = serial.Serial("/dev/ttyACM0", 9600)
        bus = pyTMCL.connect(serial_port)
        pump_1 = DispenseUnit_1161.DispenseUnit_1161("fakeparent", bus, 1, 0)

    # Pipets
    p300 = protocol.load_instrument('p300_multi_gen2', 'left')
    p20 = protocol.load_instrument('p20_multi_gen2', 'right')

    # Tips
    tiprack_300 = protocol.load_labware('opentrons_96_tiprack_300ul', 9)
    tiprack_20_plate1 = protocol.load_labware('opentrons_96_tiprack_20ul', 10)
    tiprack_20_plate2 = protocol.load_labware('opentrons_96_tiprack_20ul', 11)

    # Plates
    mother_plate1 = protocol.load_labware('greiner_96_petit_puit', 7)
    mother_plate2 = protocol.load_labware('greiner_96_petit_puit', 8)
    plate_to_normalize1 = protocol.load_labware('axygenpcr_96_wellplate_200ul_onspacer', 4)
    plate_to_normalize2 = protocol.load_labware('axygenpcr_96_wellplate_200ul_onspacer', 5)
    op2_plate1 = protocol.load_labware('axygenpcr_96_wellplate_200ul', 1)
    op2_plate2 = protocol.load_labware('axygenpcr_96_wellplate_200ul', 2)

    # Reservoirs
    LadderReservoir = protocol.load_labware('ladder_4_reservoir_63000ul', 6)


    p20.pick_up_tip(tiprack_20_plate2.wells()[0])
    p20.aspirate(10.0, mother_plate2.wells()[0].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[0].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[0].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(90.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[0].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[0].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[0].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[0].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[0].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[8])
    p20.aspirate(10.0, mother_plate2.wells()[8].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[8].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[8].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(78.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[8].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[8].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[8].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[8].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[8].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[16])
    p20.aspirate(10.0, mother_plate2.wells()[16].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[16].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[16].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(82.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[16].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[16].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[16].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[16].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[16].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[24])
    p20.aspirate(10.0, mother_plate2.wells()[24].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[24].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[24].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(78.0)
        pump_1.wait_for_canmove()
    p300.move_to(plate_to_normalize2.wells()[30].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(4.0)
        pump_1.wait_for_canmove()
    p300.move_to(plate_to_normalize2.wells()[31].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(8.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[24].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[24].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[24].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[24].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[24].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[32])
    p20.aspirate(10.0, mother_plate2.wells()[32].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[32].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[32].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(88.0)
        pump_1.wait_for_canmove()
    p300.move_to(plate_to_normalize2.wells()[38].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(4.0)
        pump_1.wait_for_canmove()
    p300.move_to(plate_to_normalize2.wells()[39].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(11.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[32].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[32].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[32].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[32].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[32].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[40])
    p20.aspirate(10.0, mother_plate2.wells()[40].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[40].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[40].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(93.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[40].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[40].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[40].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[40].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[40].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[48])
    p20.aspirate(10.0, mother_plate2.wells()[48].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[48].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[49].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(4.0)
        pump_1.wait_for_canmove()
    p300.move_to(plate_to_normalize2.wells()[55].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(84.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[48].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[48].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[48].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[48].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[48].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[56])
    p20.aspirate(10.0, mother_plate2.wells()[56].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[56].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[63].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(73.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[56].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[56].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[56].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[56].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[56].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[64])
    p20.aspirate(10.0, mother_plate2.wells()[64].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[64].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[71].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(90.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[64].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[64].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[64].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[64].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[64].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[72])
    p20.aspirate(10.0, mother_plate2.wells()[72].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[72].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[79].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(109.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[72].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[72].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[72].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[72].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[72].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[80])
    p20.aspirate(10.0, mother_plate2.wells()[80].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[80].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[87].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(94.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[80].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[80].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[80].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[80].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[80].bottom(0), 3)
    p20.return_tip()
    p20.pick_up_tip(tiprack_20_plate2.wells()[88])
    p20.aspirate(10.0, mother_plate2.wells()[88].bottom(1.3), 1)
    p20.dispense(10.0, plate_to_normalize2.wells()[88].bottom(0), 1)
    p300.move_to(plate_to_normalize2.wells()[95].center().move(types.Point(x=-2.5,y=84,z=8)))
    if protocol.is_simulating()==False:
        pump_1.wait_for_idle()
        pump_1.dispense(108.0)
        pump_1.wait_for_canmove()
    p20.move_to(plate_to_normalize2.wells()[88].top())
    p20.mix(3, 15, plate_to_normalize2.wells()[88].bottom(0), 3)
    p20.aspirate(4.0, plate_to_normalize2.wells()[88].bottom(0), 1)
    p20.dispense(4.0, op2_plate2.wells()[88].bottom(0), 1)
    p20.mix(3, 15, op2_plate2.wells()[88].bottom(0), 3)
    p20.return_tip()
